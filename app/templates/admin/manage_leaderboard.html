{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Manage Leaderboard</h1>
    </div>
    
    <div class="admin-dashboard">
        <ul>
            <li>
                <a href="{{ url_for('main.leaderboard') }}">
                    <h3>View Leaderboards</h3>
                    <p>See current rankings by key stage</p>
                </a>
            </li>
            <li>
                <a href="{{ url_for('admin.create_leaderboard_entry') }}">
                    <h3>Add New Entry</h3>
                    <p>Create a new leaderboard entry</p>
                </a>
            </li>
            <li>
                <a href="{{ url_for('admin.manage_users') }}">
                    <h3>Manage Users</h3>
                    <p>Edit user details</p>
                </a>
            </li>
        </ul>
    </div>

    <div class="page-section">
        <section class="table-container">
        <div class="table-header">
            <h2>Entries</h2>
        </div>
        <div class="table-responsive">
                <table class="users-table">
                    <thead>
                        <tr>
                        <th>👤 User</th>
                        <th>📊 Key Stage</th>
                        <th>🏆 Points</th>
                        <th>🕒 Last Updated</th>
                        <th>⚙️ Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in leaderboard[:10] %}
                    <tr class="user-row">
                        <td class="user-name">
                            <div class="user-info">
                                <span class="user-icon">
                                    {% if entry.user.is_admin %}👑{% elif entry.user.is_competition_participant %}🏆{% else %}🎓{% endif %}
                                </span>
                                <span class="user-name">{{ entry.user.full_name }}</span>
                            </div>
                        </td>
                        <td class="user-key-stage">
                                <span class="key-stage-badge ks-{{ entry.user.key_stage.lower() if entry.user.key_stage }}">
                                    {{ entry.user.key_stage }}
                                </span>
                            </td>
                        <td class="user-points">{{ entry.score }}</td>
                        <td class="user-last-updated">{{ entry.last_updated.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td class="challenge-actions">
                            <a href="{{ url_for('admin.edit_leaderboard_entry', entry_id=entry.id) }}" 
                               class="action-btn edit-btn">✏️</a>
                            <a href="{{ url_for('admin.delete_leaderboard_entry', entry_id=entry.id) }}" 
                               class="action-btn delete-btn"
                               onclick="return confirm('Are you sure you want to delete this entry?');">🗑️</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        </section>

        <section class="quick-actions">
            <h2>Quick Actions</h2>
            <div>
                <a href="{{ url_for('admin.reset_leaderboard') }}" 
                   class="button button-danger"
                   onclick="return confirm('Are you sure you want to reset the entire leaderboard? This action cannot be undone.');">
                    Reset Leaderboard
                </a>
                {% if export_enabled %}
                <a href="{{ url_for('admin.export_leaderboard') }}" class="button button-secondary">
                    Export Leaderboard
                </a>
                {% endif %}
            </div>
        </section>

        <section class="leaderboard-stats">
            <h2>Statistics by Key Stage</h2>
            <div class="stats-grid">
                <div class="stats-card">
                    <h3>KS3 Participants</h3>
                    <p>{{ ks3_count }}</p>
                </div>
                <div class="stats-card">
                    <h3>KS4 Participants</h3>
                    <p>{{ ks4_count }}</p>
                </div>
                <div class="stats-card">
                    <h3>KS5 Participants</h3>
                    <p>{{ ks5_count }}</p>
                </div>
                <div class="stats-card">
                    <h3>Total Participants</h3>
                    <p>{{ total_participants }}</p>
                </div>
                <div class="stats-card">
                    <h3>Highest Score</h3>
                    <p>{{ highest_score }}</p>
                </div>
                <div class="stats-card">
                    <h3>Average Score</h3>
                    <p>{{ average_score|round(1) }}</p>
                </div>
            </div>
        </section>
    </div>
</div>
{% endblock %}