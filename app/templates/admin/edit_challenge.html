{% extends "base.html" %}

{% block content %}
    <h1>Edit Challenge</h1>
    
    <form method="POST">
        {{ form.hidden_tag() }}
        <div>
            {{ form.title.label }}
            {{ form.title }}
            {% for error in form.title.errors %}
                <span style="color: red;">{{ error }}</span>
            {% endfor %}
        </div>
        <div>
            {{ form.content.label }}
            {{ form.content }}
            {% for error in form.content.errors %}
                <span style="color: red;">{{ error }}</span>
            {% endfor %}
        </div>
        <div>
            {{ form.image.label }}
            {{ form.image }}
            {% for error in form.image.errors %}
                <span style="color: red;">{{ error }}</span>
            {% endfor %}
            <div id="imagePreviewContainer">
                {% if form.file_url %}
                    <img id="currentImage" src="{{ url_for('static', filename='uploads./' + form.file_url) }}" alt="Current image" />
                    <p>Current image: {{ form.file_url.split("/")[1] }}</p>
                {% else %}
                    <p>No image currently uploaded.</p>
                {% endif %}
            </div>
            <div id="newImagePreview" style="display: none;">
                <img id="imagePreview" src="#" alt="New image preview" />
            </div>
        </div>
        {{ form.submit }}
    </form>

    <a href="{{ url_for('admin.manage_challenges') }}">Back to Manage Challenges</a>

    <script>
        document.getElementById('image').addEventListener('change', function(event) {
            var file = event.target.files[0];
            var reader = new FileReader();
            reader.onload = function(e) {
                var img = document.getElementById('imagePreview');
                img.src = e.target.result;
                document.getElementById('newImagePreview').style.display = 'block';
                document.getElementById('imagePreviewContainer').style.display = 'none';
            }
            reader.readAsDataURL(file);
        });
    </script>

{% endblock %}