{% extends "base.html" %}
{% block content %}
<h2>Manage Summer Challenges</h2>
<a href="{{ url_for('admin.create_summer_challenge') }}" class="button">Create New Summer Challenge</a>

<!-- Unreleased Summer Challenges -->
{% if unreleased_challenges %}
<h3>üìÖ Unreleased Summer Challenges</h3>
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Key Stage</th>
            <th>Date Posted</th>
            <th>Release Date</th>
            <th>Duration (hours)</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for challenge in unreleased_challenges %}
        <tr style="background-color: #fff3cd;">
            <td>{{ challenge.title }} <span style="color: #856404; font-weight: bold;">[UNRELEASED]</span></td>
            <td>{{ challenge.key_stage }}</td>
            <td>{{ challenge.date_posted.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ challenge.release_at.strftime('%Y-%m-%d %H:%M') if challenge.release_at else 'Not set' }}</td>
            <td>{{ challenge.duration_hours }}</td>
            <td>
                <a href="{{ url_for('admin.edit_summer_challenge', challenge_id=challenge.id) }}" class="button">Edit</a>
                <form style="display:inline;" method="POST" action="{{ url_for('admin.delete_summer_challenge', challenge_id=challenge.id) }}">
                    <button type="submit" class="button delete-button" onclick="return confirm('Are you sure?')">Delete</button>
                </form>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}

<!-- Released Summer Challenges -->
<h3>‚úÖ Released Summer Challenges</h3>
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Key Stage</th>
            <th>Date Posted</th>
            <th>Release Date</th>
            <th>Duration (hours)</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for challenge in released_challenges %}
        <tr>
            <td>{{ challenge.title }}</td>
            <td>{{ challenge.key_stage }}</td>
            <td>{{ challenge.date_posted.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ challenge.release_at.strftime('%Y-%m-%d %H:%M') if challenge.release_at else 'Immediate' }}</td>
            <td>{{ challenge.duration_hours }}</td>
            <td>
                {% if challenge.is_manually_locked %}
                    <span style="color: red; font-weight: bold;">üîí Manually Locked</span>
                {% elif challenge.is_locked %}
                    <span style="color: orange;">‚è∞ Time Expired</span>
                {% else %}
                    <span style="color: green;">üîì Open</span>
                {% endif %}
            </td>
            </td>
            <td>
                <a href="{{ url_for('admin.edit_summer_challenge', challenge_id=challenge.id) }}" class="button">Edit</a>
                
                <!-- Lock/Unlock Button -->
                <form method="POST" action="{{ url_for('admin.toggle_summer_challenge_lock', challenge_id=challenge.id) }}" style="display:inline;">
                    {% if challenge.is_manually_locked %}
                        <button type="submit" class="button unlock-button" style="background-color: #28a745; color: white;" onclick="return confirm('Unlock this challenge? Students will be able to submit answers again.');">
                            üîì Unlock
                        </button>
                    {% else %}
                        <button type="submit" class="button lock-button" style="background-color: #dc3545; color: white;" onclick="return confirm('Lock this challenge? Students will no longer be able to submit answers and answers will be revealed.');">
                            üîí Lock
                        </button>
                    {% endif %}
                </form>
                
                <form method="POST" action="{{ url_for('admin.delete_summer_challenge', challenge_id=challenge.id) }}" style="display:inline;" onsubmit="return confirm('Delete this challenge?');">
                    <button type="submit" class="button delete-button">Delete</button>
                </form>
            </td>
        </tr>
    {% else %}
        <tr><td colspan="6">No summer challenges yet.</td></tr>
    {% endfor %}
    </tbody>
</table>

<style>
.lock-button:hover {
    background-color: #c82333 !important;
}
.unlock-button:hover {
    background-color: #218838 !important;
}
</style>
{% endblock %}