{% extends "base.html" %}

{% block content %}
<div class="newsletter-detail-container">
    <!-- Newsletter Header -->
    <header class="newsletter-detail-header">
        <div class="newsletter-breadcrumb">
            <a href="{{ url_for('main.newsletters') }}">üì∞ Newsletters</a>
            <span class="breadcrumb-separator">‚Ä∫</span>
            <span>{{ article.title }}</span>
        </div>
        
        <div class="newsletter-title-section">
            <div class="newsletter-type-badge">
                <span class="type-icon">üì∞</span>
                <span>Newsletter Edition</span>
            </div>
            
            <h1 class="newsletter-detail-title">{{ article.title }}</h1>
            
            <div class="newsletter-meta-info">
                <div class="meta-item">
                    <span class="meta-icon">üìÖ</span>
                    <span class="meta-label">Published:</span>
                    <span class="meta-value">{{ article.date_posted.strftime('%B %d, %Y') }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-icon">‚úçÔ∏è</span>
                    <span class="meta-label">Editor:</span>
                    <span class="meta-value">{{ article.named_creator }}</span>
                </div>
                {% if article.file_url %}
                <div class="meta-item">
                    <span class="meta-icon">üìÑ</span>
                    <span class="meta-label">Format:</span>
                    <span class="meta-value">Digital + PDF Edition</span>
                </div>
                {% endif %}
            </div>
        </div>
    </header>

    <!-- Newsletter Content -->
    <div class="newsletter-detail-content">
        <div class="newsletter-body">
            <div class="content-intro">
                <h2>üìñ Newsletter Content</h2>
                <p>Read the digital version below or download the PDF for the complete formatted edition.</p>
            </div>
            
            <div class="newsletter-text-content">
                {{ article.content | safe }}
            </div>
        </div>

        {% if article.file_url %}
        <div class="pdf-section">
            <div class="pdf-section-header">
                <h2>üìÑ PDF Newsletter Edition</h2>
                <p>Experience the complete newsletter with professional formatting, graphics, and additional content</p>
            </div>
            
            <!-- PDF Viewer -->
            <div class="pdf-viewer-container">
                <div class="pdf-viewer-header">
                    <h3>Newsletter PDF Preview</h3>
                    <div class="pdf-controls">
                        <a href="{{ url_for('main.serve_newsletter', filename=article.file_url) }}" 
                           target="_blank" class="button button-secondary">
                            <span>üîç</span> Full Screen
                        </a>
                        <a href="{{ url_for('main.serve_newsletter', filename=article.file_url) }}" 
                           download class="button">
                            <span>üíæ</span> Download PDF
                        </a>
                        <button onclick="printNewsletter('{{ url_for('main.serve_newsletter', filename=article.file_url) }}')" 
                                class="button button-outline">
                            <span>üñ®Ô∏è</span> Print
                        </button>
                    </div>
                </div>
                
                <div class="pdf-viewer">
                    <iframe src="{{ url_for('main.serve_newsletter', filename=article.file_url) }}"
                            width="100%" height="700" frameborder="0"
                            title="Newsletter PDF Preview"></iframe>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Newsletter Actions -->
    <div class="newsletter-detail-actions">
        <div class="action-buttons">
            <a href="{{ url_for('main.newsletters') }}" class="button button-secondary">
                <span>‚Üê </span> Back to Newsletters
            </a>
            
            {% if article.file_url %}
            <a href="{{ url_for('main.serve_newsletter', filename=article.file_url) }}" 
               target="_blank" class="button">
                <span>üìÑ</span> Open PDF
            </a>
            <a href="{{ url_for('main.serve_newsletter', filename=article.file_url) }}" 
               download class="button button-outline">
                <span>üíæ</span> Download
            </a>
            {% endif %}
            
            {% if current_user.is_admin %}
            <a href="{{ url_for('admin.edit_article', article_id=article.id) }}" 
               class="button button-outline">
                <span>‚úèÔ∏è</span> Edit Newsletter
            </a>
            {% endif %}
        </div>
        
        <!-- Share Section -->
        <div class="share-section">
            <h3>Share this Newsletter</h3>
            <div class="share-buttons">
                <button onclick="copyToClipboard('{{ request.url }}')" class="share-btn copy-btn">
                    <span>üîó</span> Copy Link
                </button>
                <a href="mailto:?subject={{ article.title | urlencode }}&body=Check out this newsletter: {{ request.url | urlencode }}" 
                   class="share-btn email-btn">
                    <span>‚úâÔ∏è</span> Share via Email
                </a>
                {% if article.file_url %}
                <a href="mailto:?subject={{ article.title | urlencode }}&body=Check out this newsletter: {{ request.url | urlencode }}%0A%0APDF Download: {{ url_for('main.serve_newsletter', filename=article.file_url, _external=True) | urlencode }}" 
                   class="share-btn email-pdf-btn">
                    <span>üìé</span> Share PDF Link
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Newsletter Navigation -->
    <div class="newsletter-footer">
        <div class="newsletter-navigation">
            <div class="nav-item">
                <span class="nav-icon">üì∞</span>
                <div class="nav-content">
                    <h4>More Newsletters</h4>
                    <p>Explore our archive of mathematical insights and society updates</p>
                    <a href="{{ url_for('main.newsletters') }}" class="nav-link">Browse All Newsletters ‚Üí</a>
                </div>
            </div>
            
            <div class="nav-item">
                <span class="nav-icon">üìö</span>
                <div class="nav-content">
                    <h4>Read Articles</h4>
                    <p>Discover in-depth mathematical research and educational content</p>
                    <a href="{{ url_for('main.articles') }}" class="nav-link">View Articles ‚Üí</a>
                </div>
            </div>
            
            <div class="nav-item">
                <span class="nav-icon">üßÆ</span>
                <div class="nav-content">
                    <h4>Try Challenges</h4>
                    <p>Put your mathematical knowledge to the test</p>
                    <a href="{{ url_for('main.challenges') }}" class="nav-link">View Challenges ‚Üí</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Show a temporary success message
        const button = event.target.closest('.copy-btn');
        const originalText = button.innerHTML;
        button.innerHTML = '<span>‚úÖ</span> Copied!';
        button.style.background = '#28a745';
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.style.background = '';
        }, 2000);
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        const button = event.target.closest('.copy-btn');
        const originalText = button.innerHTML;
        button.innerHTML = '<span>‚úÖ</span> Copied!';
        setTimeout(() => {
            button.innerHTML = originalText;
        }, 2000);
    });
}

function printNewsletter(pdfUrl) {
    // Open PDF in a new window and trigger print
    const printWindow = window.open(pdfUrl, '_blank');
    printWindow.onload = function() {
        printWindow.print();
    };
}
</script>
{% endblock %}